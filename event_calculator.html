<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>이벤트 아이템 계산기</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .item-row { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
    .item-row select, .item-row input { margin-right: 8px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
    th { background: #f0f0f0; }
    #exchangeImage { margin-top: 20px; }
    #exchangeImage img { max-width: 400px; border: 1px solid #ccc; }
  </style>
</head>
<body>

<h1>이벤트 아이템 계산기</h1>

<section>
  <label>이벤트 종류:
    <select id="eventType" onchange="resetItemList(); showExchangeImage();">
      <option value="">-- 선택하세요 --</option>
      <option value="stage">꿈의 스테이지, music on!</option>
      <option value="cherry">토끼, 아니 체리야 이리오너라!</option>
    </select>
  </label>
</section>

<section style="margin-top: 10px;">
  <label>시작일: <input type="date" id="startDate"></label>
  <label>종료일: <input type="date" id="endDate"></label>
  <span id="totalDays"></span>
</section>

<h2>아이템 목록</h2>
<div id="itemList"></div>
<button onclick="addItem()">아이템 추가</button>
<button onclick="calculateTotals()">총 필요량 계산</button>

<h2>계산 결과</h2>
<table>
  <thead>
    <tr>
      <th>아이템</th>
      <th>하루 필요 개수</th>
      <th>총 필요 개수</th>
    </tr>
  </thead>
  <tbody id="resultTable"></tbody>
</table>

<div id="exchangeImage"></div>

<script>
  const eventItems = {
    stage: {
      items: ["포토카드", "아이돌 앨범", "광천수", "콘서트 티켓"],
      image: "9c0184f3-79c4-43fc-b0c0-a107dbadb047.png"
    },
    cherry: {
      items: ["용왕님의 편지", "통나무", "체리", "용궁 행 티켓"],
      image: "faf90322-dcce-4328-b85d-f37062a53ae9.png"
    }
  };

  const fixedPerDay = {
    "포토카드": 30,
    "아이돌 앨범": 20,
    "광천수": 50,
    "콘서트 티켓": 25,
    
    "용왕님의 편지": 20,
    "통나무": 50,
    "체리": 150,
    "용궁 행 티켓": 20
  };

  function daysBetween(start, end) {
    const s = new Date(start);
    const e = new Date(end);
    if (isNaN(s) || isNaN(e)) return 0;
    return Math.floor((e - s) / (1000 * 60 * 60 * 24)) + 1; // 포함 계산
  }

  function addItem() {
    const eventType = document.getElementById("eventType").value;
    if (!eventType) {
      alert("먼저 이벤트 종류를 선택하세요.");
      return;
    }

    const options = eventItems[eventType].items
      .map(item => `<option value="${item}">${item}</option>`)
      .join("");

    const container = document.createElement("div");
    container.className = "item-row";
    container.innerHTML = `
      <select onchange="setFixedValue(this)">${options}</select>
      하루 필요 개수: <input type="number" min="1" value="1" readonly>
      <button onclick="this.parentElement.remove()">삭제</button>
    `;
    document.getElementById("itemList").appendChild(container);

    // 초기값도 설정
    setFixedValue(container.querySelector("select"));
  }

  function setFixedValue(selectElem) {
    const itemName = selectElem.value;
    const input = selectElem.parentElement.querySelector("input");
    if (fixedPerDay[itemName] !== undefined) {
      input.value = fixedPerDay[itemName];
    }
  }

  function resetItemList() {
    document.getElementById("itemList").innerHTML = "";
    document.getElementById("resultTable").innerHTML = "";
  }

  function showExchangeImage() {
    const eventType = document.getElementById("eventType").value;
    const container = document.getElementById("exchangeImage");
    container.innerHTML = "";
    if (eventType && eventItems[eventType].image) {
      const img = document.createElement("img");
      img.src = eventItems[eventType].image;
      container.appendChild(img);
    }
  }

  function calculateTotals() {
    const startDate = document.getElementById("startDate").value;
    const endDate = document.getElementById("endDate").value;
    const totalDays = daysBetween(startDate, endDate);
    document.getElementById("totalDays").textContent = totalDays > 0 ? `총 ${totalDays}일` : "";

    if (totalDays <= 0) {
      alert("올바른 기간을 선택하세요.");
      return;
    }

    const rows = document.querySelectorAll("#itemList .item-row");
    if (rows.length === 0) {
      alert("아이템을 최소 1개 이상 추가하세요.");
      return;
    }

    const resultBody = document.getElementById("resultTable");
    resultBody.innerHTML = "";

    rows.forEach(row => {
      const itemName = row.querySelector("select").value;
      const perDay = parseInt(row.querySelector("input").value, 10) || 0;
      const total = perDay * totalDays;

      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${itemName}</td><td>${perDay}</td><td>${total}</td>`;
      resultBody.appendChild(tr);
    });
  }
</script>

</body>
</html>
